# 月次確認・承認機能 セットアップガイド

## 📋 概要

この機能により、部署ごとの打刻データを月単位で確認し、複数段階の承認を行うことができます。

### 承認フロー
```
未承認 → 第1承認(主任・係長) → 第2承認(課長・部長) → 完了
```

## 🔧 セットアップ手順

### 1. Google Apps Scriptの更新

1. スプレッドシートから「拡張機能」→「Apps Script」を開く
2. `Code.gs`の内容を、新しい`Code.gs`ファイルの内容で**完全に置き換え**
3. 保存(Ctrl+S)
4. **重要**: 既存のデプロイを更新
   - 「デプロイ」→「デプロイを管理」
   - 既存のデプロイの右側の鉛筆アイコン(編集)をクリック
   - バージョンを「新バージョン」に変更
   - 「デプロイ」をクリック

### 2. HTMLファイルの追加

Google Apps Scriptエディタで:

1. 左側の「ファイル」セクションで「+」→「HTML」をクリック
2. ファイル名を`MonthlyReview`に設定
3. `MonthlyReview.html`の内容をコピー&ペースト
4. 保存

### 3. 承認者マスタシートの作成

スプレッドシートに戻り:

1. 新しいシートを作成し、名前を「**承認者マスタ**」に変更
2. 1行目にヘッダーを入力:
   ```
   A列: 部署
   B列: 第1承認者
   C列: 第2承認者
   ```
3. 2行目以降に各部署の承認者を設定:
   ```
   営業部  | 山田 太郎  | 鈴木 一郎
   総務部  | 佐藤 花子  | 田中 次郎
   ```

### 4. 月次承認記録シート(自動作成)

- 初回の承認実行時に自動で作成されます
- 手動で作成する必要はありません

## 📱 使い方

### アクセス方法

#### 方法1: 打刻画面から
1. `index.html`を開く
2. ヘッダーの「📋 月次確認・承認」リンクをクリック

#### 方法2: 直接アクセス
- `MonthlyReview.html`を直接開く

### 承認手順

1. **部署を選択**
2. **年月を選択**(デフォルトは今月)
3. **承認者名を入力**(自分の名前を入力)
4. **「データ表示」ボタンをクリック**
5. 打刻データを確認
6. 承認ボタンをクリック:
   - 第1承認者の場合: 「第1承認を実行」
   - 第2承認者の場合: 「第2承認を実行」(第1承認完了後のみ表示)

## ⚠️ 注意事項

### 承認権限
- 承認者マスタに登録されている名前と**完全に一致**する必要があります
- 第1承認者は第1承認のみ実行可能
- 第2承認者は第2承認のみ実行可能(第1承認完了後)

### 承認の取り消し
承認を取り消す場合:
1. スプレッドシートの「月次承認記録」シートを開く
2. 該当する行を削除

### トラブルシューティング

#### 「承認者として登録されていません」エラー
- 承認者マスタに自分の名前が正しく登録されているか確認
- 入力した名前と承認者マスタの名前が完全に一致しているか確認(スペースや全角/半角に注意)

#### 「第1承認が完了していません」エラー
- 第2承認は第1承認が完了していないと実行できません
- 第1承認者に先に承認してもらってください

#### データが表示されない
- 選択した部署と年月に打刻データが存在するか確認
- 部署名が社員マスタと一致しているか確認

## 🎨 画面の説明

### 承認状況の表示
- **未承認**: グレーの円
- **第1承認済み**: 緑のチェックマーク
- **第2承認済み(完了)**: すべてのステップが緑のチェックマーク

### データテーブル
以下の情報が表示されます:
- 日付
- 社員コード
- 氏名
- 出勤時刻
- 退勤時刻
- 勤務時間
- 備考

## 🔄 更新履歴

- 2025-11-30: 初版リリース
  - 複数段階承認機能の実装
  - 承認状況の視覚的表示
  - 承認者権限管理
