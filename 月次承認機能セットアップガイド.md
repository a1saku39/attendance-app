# 月次勤怠確認・承認機能 セットアップガイド (改訂版)

## 概要

月次勤怠確認・承認機能が個人単位の承認フローに変更されました。

### 承認フロー

1. **担当者印**: 社員本人が自分の月次勤怠データを確認し、「担当者印」を押します。
2. **承認印**: 担当者印が押された後、第1承認者が「承認印」を押します。
3. 第2承認者は廃止されました。

---

## セットアップ手順

### 1. 社員マスタの更新

スプレッドシートの「社員マスタ」シートに **H列「印鑑」** を追加してください。

#### 列構成（更新後）

| 列 | 項目名 | 説明 | 例 |
|----|--------|------|-----|
| A | 社員コード | 社員の一意なID | 1001 |
| B | 氏名 | 社員の氏名 | 山田 太郎 |
| C | 部署 | 所属部署 | 東京支店 |
| D | 承認対象部署 | （旧仕様、現在は未使用） | - |
| E | 第1承認者 | この社員の承認者氏名 | 佐藤 次郎 |
| F | 第2承認者 | （廃止、空欄でOK） | - |
| G | メールアドレス | リマインダー用 | yamada@example.com |
| **H** | **印鑑** | **印鑑に表示する名前** | **山田** |

#### H列「印鑑」について

- 承認印を押した際に表示される名前を設定します。
- 通常は **苗字のみ** を入力することを推奨します（例: 「山田」）。
- 空欄の場合は、B列の「氏名」がそのまま使用されます。

#### 設定例

```
A列    B列        C列      D列  E列        F列  G列                 H列
1001   山田 太郎  東京支店  -    佐藤 次郎  -    yamada@example.com  山田
1002   佐藤 次郎  東京支店  -    田中 花子  -    sato@example.com    佐藤
1003   鈴木 一郎  大阪支店  -    高橋 三郎  -    suzuki@example.com  鈴木
```

---

### 2. Google Apps Scriptのデプロイ

1. Google Apps Scriptエディタで `Code.gs` を最新版に更新してください。
2. 「デプロイ」→「デプロイを管理」→ 編集アイコン → 「新バージョン」を選択 → 「デプロイ」

---

### 3. 月次勤怠確認画面の使い方

#### 社員本人の操作

1. `MonthlyReview.html` を開きます（または勤怠アプリのメニューから「月次確認」を選択）。
2. 自分の **社員コード** と **年月** を入力し、「データを表示」をクリック。
3. カレンダー形式で自分の勤怠データが表示されます。
4. 内容を確認し、問題なければ **「担当者印を押す」** ボタンをクリック。
5. 確認ダイアログで「OK」を押すと、担当者印が押されます。

#### 承認者の操作

1. 部下の社員コードと年月を入力し、「データを表示」をクリック。
2. 担当者印が押されていることを確認。
3. **「承認印を押す」** ボタンをクリック。
4. 自分の社員コードを入力するプロンプトが表示されるので、入力。
5. 確認ダイアログで「OK」を押すと、承認印が押されます。

---

## データ保存先

承認データは **「月次承認記録_個人」** シートに保存されます。

### シート構造

| 列 | 項目名 | 説明 |
|----|--------|------|
| A | 年月 | 対象年月（例: 2025-12） |
| B | 社員ID | 対象社員の社員コード |
| C | 本人確認者 | 担当者印を押した人の名前 |
| D | 本人確認日時 | 担当者印を押した日時 |
| E | 承認者 | 承認印を押した人の名前 |
| F | 承認日時 | 承認印を押した日時 |

---

## 権限チェック

### 担当者印

- **本人のみ** が押せます。
- 他人のデータに担当者印を押そうとするとエラーになります。

### 承認印

- 社員マスタの **E列「第1承認者」** に登録されている人のみが押せます。
- 例: 山田さんのE列に「佐藤 次郎」と登録されている場合、佐藤さんのみが山田さんの承認印を押せます。
- 担当者印が押されていない場合は、承認印を押せません。

---

## トラブルシューティング

### Q1. 「操作者の情報がマスタに見つかりません」と表示される

**原因**: 入力した社員コードが社員マスタに登録されていません。

**対処法**: 社員マスタのA列に該当する社員コードが存在するか確認してください。

### Q2. 「あなたはこの社員の承認権限を持っていません」と表示される

**原因**: 承認しようとしている社員のE列「第1承認者」に、あなたの氏名が登録されていません。

**対処法**: 
1. 社員マスタで対象社員の行を確認。
2. E列「第1承認者」にあなたの氏名（B列と完全一致）が登録されているか確認。
3. 登録されていない場合は、管理者に依頼して追加してもらってください。

### Q3. 印鑑に表示される名前を変更したい

**対処法**: 社員マスタのH列「印鑑」を編集してください。空欄の場合はB列「氏名」が使用されます。

### Q4. 一度押した印鑑を取り消したい

**対処法**: 現在の仕様では、押印後の取り消しはできません。誤って押印した場合は、「月次承認記録_個人」シートから該当行を手動で削除してください。

---

## 旧仕様からの変更点

| 項目 | 旧仕様 | 新仕様 |
|------|--------|--------|
| 承認単位 | 部署×年月 | 社員個人×年月 |
| 承認段階 | 第1承認、第2承認 | 担当者印、承認印 |
| 承認者 | 部署の承認者 | 個人の第1承認者 |
| データ保存 | 月次承認記録 | 月次承認記録_個人 |
| 印鑑表示 | なし | 社員マスタH列で設定可能 |

---

以上でセットアップは完了です。
