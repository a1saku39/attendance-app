# 勤怠管理アプリ セットアップ手順

このアプリは、Googleスプレッドシートと連携して出退勤時間を記録します。
社員コードを入力することで、スプレッドシート上の「社員マスタ」から名前を自動で取得して記録します。

## 1. Googleスプレッドシートの準備
1. Googleドライブで「新規」→「Googleスプレッドシート」を作成します。
2. シートの名前は適当で構いません(例: 「勤怠管理データ」)。
3. **重要**: 以下のシートを用意してください。
    - **シート名: `社員マスタ`**
        - 1行目: A列「社員コード」、B列「氏名」、C列「部署」と入力
        - 2行目以降: 実際の社員データを入力してください
        - 例:
          ```
          A列(社員コード) | B列(氏名)    | C列(部署)
          1001           | 山田 太郎    | 営業部
          1002           | 佐藤 花子    | 総務部
          1003           | 鈴木 一郎    | 営業部
          ```
    - **その他のシート**: 打刻データは自動で作成されます
        - `打刻_営業部`、`打刻_総務部` など部署ごとのシート
          - 列構成: A:日にち, B:社員コード, C:名前, D:種別出勤, E:出勤時刻, F:種別退勤, G:退勤時刻, **H:勤務時間**, **I:備考**
          - H列の勤務時間は退勤時に自動計算されます(退勤時刻 - 出勤時刻)
        - `打刻データ_全体` 全部署の打刻を一覧できるシート

## 2. Google Apps Script (GAS) の設定
1. スプレッドシートのメニューから「拡張機能」→「Apps Script」をクリックします。
2. コードエディタが開くので、元々入っているコードを消し、このフォルダ内の `Code.gs` の内容をすべてコピーして貼り付けます。
3. `Ctrl + S` (Macは `Cmd + S`) で保存します。

## 3. デプロイとURLの取得
1. 右上の「デプロイ」ボタン → 「新しいデプロイ」をクリックします。
2. 左上の歯車アイコン → 「ウェブアプリ」を選択します。
3. 以下の設定にします:
   - **説明**: 勤怠管理アプリ(任意)
   - **次のユーザーとして実行**: 自分
   - **アクセスできるユーザー**: **全員** (これ重要です!スマホからアクセスするために必要です)
4. 「デプロイ」ボタンをクリックします。
5. 「アクセスを承認」という画面が出たら、承認を進めてください(「安全ではないページ」と出た場合は、左下の「詳細」→「(安全ではないページ)に移動」をクリック)。
6. **ウェブアプリのURL** が表示されるので、コピーします。

## 4. アプリへの設定
1. `index.html` をブラウザで開きます。
2. 画面下部の「設定(管理者用)」をクリックして開きます。
3. 「GAS WebアプリURL」の欄に、先ほどコピーしたURLを貼り付けます。
4. 「保存」ボタンを押します。

## 5. 使い方
1. 「社員コード」欄に自分のコードを入力します(例: 1001)。
2. 「出勤」または「退勤」ボタンを押します。
3. 「記録しました!」と表示されれば成功です。スプレッドシートの「打刻データ」シートに行が追加されているか確認してください。

## 変更履歴
- 2025-11-29: H列に勤務時間(退勤時刻 - 出勤時刻)を追加、備考をI列に移動
- 2025-11-30: 月次確認・承認機能を追加

## 6. 月次確認・承認機能(新機能)

### 概要
部署ごとの打刻データを月単位で確認し、複数段階の承認を行う機能です。

### 必要なシートの準備

#### 承認者マスタシート
1. スプレッドシートに「**承認者マスタ**」という名前のシートを作成します
2. 1行目に以下のヘッダーを入力:
   - A列: `部署`
   - B列: `第1承認者`
   - C列: `第2承認者`
3. 2行目以降に各部署の承認者を設定します
   - 例:
     ```
     部署    | 第1承認者  | 第2承認者
     営業部  | 山田 太郎  | 鈴木 一郎
     総務部  | 佐藤 花子  | 田中 次郎
     ```

#### 月次承認記録シート
- 初回の承認実行時に自動で作成されます
- 列構成: A:部署, B:年月, C:第1承認者, D:第1承認日時, E:第2承認者, F:第2承認日時

### 使い方

1. **打刻画面から月次確認画面へ移動**
   - `index.html`のヘッダーにある「📋 月次確認・承認」リンクをクリック
   - または直接`MonthlyReview.html`を開く

2. **データの表示**
   - 部署を選択
   - 年月を選択(デフォルトは今月)
   - 承認者名を入力(自分の名前)
   - 「データ表示」ボタンをクリック

3. **承認の実行**
   - 表示されたデータを確認
   - 承認状況に応じて、以下のボタンが表示されます:
     - **第1承認を実行**: 第1承認者のみ実行可能
     - **第2承認を実行**: 第1承認完了後、第2承認者のみ実行可能
   - ボタンをクリックして承認を実行

4. **承認フロー**
   ```
   未承認 → 第1承認済み → 第2承認済み(完了)
   ```
   - 第1承認と第2承認の両方が完了して初めて「承認完了」となります
   - 承認者マスタに登録されていない人は承認できません

### 注意事項
- 承認を実行する前に、必ず承認者マスタに自分の名前が登録されているか確認してください
- 第2承認は第1承認が完了していないと実行できません
- 承認済みのデータを取り消す場合は、スプレッドシートの「月次承認記録」シートから該当行を削除してください

